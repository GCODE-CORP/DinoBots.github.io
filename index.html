<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DinoBot Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap'); body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); } .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); } .card-hover:hover { transform: translateY(-2px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); } .ai-glow { box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); } .slide-in { animation: slideIn 0.5s ease-out; } @keyframes slideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } } .fade-in { animation: fadeIn 0.5s ease-out; } @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } @media (max-width: 768px) { .mobile-sidebar { transform: translateX(-100%); transition: transform 0.3s ease; } .mobile-sidebar.open { transform: translateX(0); } .mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); z-index: 30; } .mobile-overlay.active { display: block; } .mobile-main { margin-left: 0 !important; padding-top: 5rem !important; } .mobile-modal { width: 95% !important; } } ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); } ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); }
    </style>
</head>
<body class="min-h-screen">
    <div id="loginScreen" class="fixed inset-0 flex items-center justify-center z-50 p-4">
        <div class="glass rounded-2xl p-8 w-full max-w-sm shadow-2xl">
            <div class="text-center mb-8"><div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 ai-glow"><i class="fas fa-robot text-3xl text-white"></i></div><h1 class="text-2xl font-bold text-white mb-2">LINE OA Management</h1><p class="text-white/70">DinoBot Project</p></div>
            <form onsubmit="login(event)" class="space-y-6">
                <div><label class="block text-white/80 text-sm font-medium mb-2"><i class="fas fa-user-shield mr-2"></i>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label><input type="text" id="loginUsername" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required value="Admin"></div>
                <div><label class="block text-white/80 text-sm font-medium mb-2"><i class="fas fa-key mr-2"></i>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label><input type="password" id="loginPassword" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required></div>
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 rounded-lg font-medium ai-glow"><i class="fas fa-sign-in-alt mr-2"></i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            </form>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <div id="mobileOverlay" class="mobile-overlay" onclick="closeMobileSidebar()"></div>
        <header class="glass fixed top-0 left-0 right-0 z-40 px-4 md:px-6 py-3"><div class="flex items-center justify-between"><div class="flex items-center space-x-4"><button onclick="toggleMobileSidebar()" class="md:hidden text-white p-2"><i class="fas fa-bars"></i></button><div class="flex items-center space-x-2"><div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center ai-glow"><i class="fas fa-robot text-xl text-white"></i></div><div class="hidden sm:block"><h1 class="font-bold text-white">DinoBotsCorp</h1><p class="text-white/70 text-sm">Admin Panel</p></div></div></div><div class="flex items-center space-x-4"><div class="relative"><button onclick="toggleUserMenu()" class="flex items-center space-x-2 glass px-3 py-2 rounded-lg"><i class="fas fa-user-circle text-white"></i><span id="currentUserDisplay" class="text-white text-sm">Admin</span><i class="fas fa-chevron-down text-white/70 text-xs"></i></button><div id="userMenu" class="hidden absolute right-0 mt-2 w-48 glass rounded-lg shadow-xl z-20"><a href="#" onclick="showAdminManagement()" class="block px-4 py-2 text-white hover:bg-white/10 rounded-t-lg"><i class="fas fa-users-cog mr-2 w-5"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</a><a href="#" onclick="logout()" class="block px-4 py-2 text-white hover:bg-white/10 rounded-b-lg"><i class="fas fa-sign-out-alt mr-2 w-5"></i>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a></div></div></div></div></header>
        <aside id="sidebar" class="fixed left-0 top-16 w-64 h-full glass slide-in mobile-sidebar z-10"><nav class="p-4"><div class="space-y-2"><a href="#" onclick="showSection('dashboard', this)" class="nav-item flex items-center space-x-3 p-3 rounded-lg bg-white/20 text-white"><i class="fas fa-chart-line w-5"></i><span>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</span></a><a href="#" onclick="showSection('keywords', this)" class="nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-white/10 text-white"><i class="fas fa-tags w-5"></i><span>‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</span></a></div></nav></aside>
        
        <main class="md:ml-64 pt-16 p-4 md:p-6 mobile-main">
            <div id="dashboard" class="section fade-in"><div class="mb-6"><h2 class="text-2xl font-bold text-white">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h2><p class="text-white/70">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p></div><div class="glass rounded-xl p-4 md:p-6 mb-6 card-hover"><h3 class="text-lg font-semibold text-white mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LINE Official Account</h3><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"><div class="bg-white/10 rounded-lg p-3"><div class="flex items-center space-x-3"><i class="fas fa-store text-2xl text-blue-400"></i><div><p class="font-medium text-white">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</p><p id="oaName" class="text-white/70 text-sm">Loading...</p></div></div></div><div class="bg-white/10 rounded-lg p-3"><div class="flex items-center space-x-3"><i class="fas fa-id-card text-2xl text-green-400"></i><div><p class="font-medium text-white">Channel ID</p><p id="channelId" class="text-white/70 text-sm">Loading...</p></div></div></div><div class="bg-white/10 rounded-lg p-3"><div class="flex items-center space-x-3"><i class="fas fa-users text-2xl text-purple-400"></i><div><p class="font-medium text-white">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</p><p id="followerCount" class="text-white/70 text-sm">Loading...</p></div></div></div></div></div></div>

            <div id="keywords" class="section hidden fade-in"><div class="mb-6"><h2 class="text-2xl font-bold text-white">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</h2><p class="text-white/70">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏•‡∏ö ‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</p></div><div class="glass rounded-xl p-4 md:p-6"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold text-white">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</h3><button onclick="document.getElementById('addKeywordModal').classList.remove('hidden')" class="bg-blue-500 text-white px-4 py-2 rounded-lg ai-glow"><i class="fas fa-plus mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button></div><div id="keywordsList" class="space-y-2"></div></div></div>
        </main>
        
        <div id="adminModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 p-4"><div class="glass rounded-xl w-full max-w-lg mobile-modal max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center p-4 border-b border-white/20"><h3 class="text-xl font-semibold text-white"><i class="fas fa-users-cog mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3><button onclick="hideAdminModal()" class="text-white text-2xl">&times;</button></div><div class="p-4"><div class="bg-white/10 rounded-lg p-4 mb-4"><h4 class="font-medium text-white mb-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà</h4><div class="flex flex-col sm:flex-row gap-3"><input type="text" id="newAdminName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" class="flex-1 px-3 py-2 bg-white/10 rounded-lg text-white"><input type="password" id="newAdminPassword" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="flex-1 px-3 py-2 bg-white/10 rounded-lg text-white"><button onclick="addAdmin()" class="bg-green-500 text-white px-4 py-2 rounded-lg"><i class="fas fa-plus"></i></button></div></div><div><h4 class="font-medium text-white mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h4><div id="adminList" class="space-y-2"></div></div></div></div></div>
        <div id="addKeywordModal" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center z-50 p-4"><div class="glass rounded-xl w-full max-w-2xl mobile-modal max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center p-4 border-b border-white/20"><h3 class="text-xl font-semibold text-white"><i class="fas fa-plus-circle mr-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</h3><button onclick="closeKeywordModal()" class="text-white text-2xl">&times;</button></div><form onsubmit="addKeyword(event)" class="p-4 space-y-4"><input type="hidden" id="keywordId"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-white/80 mb-1">‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</label><input type="text" id="newKeyword" class="w-full bg-white/10 p-2 rounded-lg text-white" required></div><div><label class="block text-sm font-medium text-white/80 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label><select id="messageType" onchange="toggleMessageInputs()" class="w-full bg-white/20 p-2 rounded-lg text-white"><option value="text">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</option><option value="image">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</option><option value="flex">Flex Message</option></select></div></div><div id="textInput"><label class="block text-sm font-medium text-white/80 mb-1">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label><textarea id="messageContent" class="w-full bg-white/10 p-2 rounded-lg text-white h-24"></textarea></div><div id="imageInput" class="hidden space-y-2"><label class="block text-sm font-medium text-white/80 mb-1">URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</label><input type="url" id="imageUrl" class="w-full bg-white/10 p-2 rounded-lg text-white"></div><div id="flexInput" class="hidden space-y-2"><label class="block text-sm font-medium text-white/80 mb-1">Flex Message JSON</label><textarea id="flexJson" class="w-full bg-black/20 p-2 rounded-lg text-white font-mono h-32"></textarea></div><div class="flex justify-end gap-4 pt-4"><button type="button" onclick="closeKeywordModal()" class="bg-gray-500/50 text-white px-4 py-2 rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded-lg ai-glow">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></form></div></div>
    </div>
    <div id="notificationContainer" class="fixed top-4 right-4 z-[100] space-y-2"></div>

    <script>
        // =======================================================
        // SCRIPT SECTION (‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)
        // =======================================================
        
        let currentUser = null, keywords = [], admins = [];

        // ** ‚ùóÔ∏è‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏™‡πà URL ‡πÅ‡∏•‡∏∞ TOKEN ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà **
        const GOOGLE_APPS_SCRIPT_URL = "YOUR_GOOGLE_APPS_SCRIPT_URL";
        const CHANNEL_ACCESS_TOKEN = "YOUR_CHANNEL_ACCESS_TOKEN";

        // =======================================================
        // üë§ AUTH & ADMIN MANAGEMENT
        // =======================================================
        async function login(event) {
            event.preventDefault();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            if (!username || !password) return showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'error');

            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', 'info');
            const formData = new FormData();
            formData.append('source', 'admin_panel');
            formData.append('action', 'login');
            formData.append('username', username);
            formData.append('password', password);

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, { method: 'POST', body: formData });
                if (!response.ok) throw new Error(`Server error: ${response.statusText}`);
                const result = await response.json();

                if (result.status === 'success') {
                    currentUser = result.user;
                    document.getElementById('currentUserDisplay').textContent = currentUser.name;
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    
                    showNotification(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ${currentUser.name}!`, 'success');
                    fetchBotInfo();
                    fetchKeywords();
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                console.error("Login Error:", error);
                showNotification(`‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ${error.message}`, 'error');
            }
        }

        async function fetchAdmins() {
            try {
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getAdmins`);
                const result = await response.json();
                if (result.status === 'success') {
                    admins = result.data;
                    populateAdminList();
                } else { throw new Error(result.message); }
            } catch (error) {
                showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }
        
        async function addAdmin() {
            const name = document.getElementById('newAdminName').value.trim();
            const password = document.getElementById('newAdminPassword').value.trim();
            if (!name || !password) return showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');

            const formData = new FormData();
            formData.append('source', 'admin_panel');
            formData.append('action', 'addAdmin');
            formData.append('name', name);
            formData.append('password', password);

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, { method: 'POST', body: formData });
                const result = await response.json();
                if (result.status === 'success') {
                    showNotification('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    document.getElementById('newAdminName').value = '';
                    document.getElementById('newAdminPassword').value = '';
                    fetchAdmins();
                } else { throw new Error(result.message); }
            } catch (error) {
                showNotification(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        async function deleteAdmin(id) {
            if (id === 1) return showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö Super Admin ‡πÑ‡∏î‡πâ', 'warning');
            if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ID: ${id}?`)) return;
            
            const formData = new FormData();
            formData.append('source', 'admin_panel');
            formData.append('action', 'deleteAdmin');
            formData.append('id', id);

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, { method: 'POST', body: formData });
                const result = await response.json();
                if (result.status === 'success') {
                    showNotification('‡∏•‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    fetchAdmins();
                } else { throw new Error(result.message); }
            } catch (error) {
                showNotification(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        function populateAdminList() {
            const container = document.getElementById('adminList');
            if (!admins || admins.length === 0) {
                container.innerHTML = `<p class="text-white/60 text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</p>`;
                return;
            }
            container.innerHTML = admins.map(admin => `
                <div class="flex justify-between items-center p-3 bg-white/10 rounded-lg">
                    <div class="flex items-center space-x-3"><i class="fas fa-user-shield text-blue-400"></i><div><span class="text-white font-medium">${admin.name} (ID: ${admin.id})</span><div class="text-xs text-white/60">${admin.lastLogin ? '‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + new Date(admin.lastLogin).toLocaleString('th-TH') : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ'}</div></div></div>
                    <div class="flex items-center space-x-2"><span class="bg-${admin.active ? 'green' : 'red'}-500 text-white text-xs px-2 py-1 rounded">${admin.active ? 'Active' : 'Inactive'}</span>${admin.id !== 1 ? `<button onclick="deleteAdmin(${admin.id})" class="text-red-300 hover:text-red-100"><i class="fas fa-trash"></i></button>` : ''}</div>
                </div>`).join('');
        }
        
        function logout() { window.location.reload(); }

        // =======================================================
        // üîë KEYWORD MANAGEMENT
        // =======================================================
        async function fetchKeywords() {
            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î...', 'info');
            try {
                const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?action=getKeywords`);
                const result = await response.json();
                if (result.status === 'success') {
                    keywords = result.data;
                    populateKeywords();
                } else { throw new Error(result.message); }
            } catch (error) {
                showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }

        function addKeyword(event) {
            event.preventDefault();
            const keywordText = document.getElementById('newKeyword').value.trim();
            if (!keywordText) return showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î', 'error');

            const messageType = document.getElementById('messageType').value;
            let content = '', altText = '';
            if (messageType === 'text') content = document.getElementById('messageContent').value.trim();
            else if (messageType === 'image') content = document.getElementById('imageUrl').value.trim();
            else if (messageType === 'flex') content = document.getElementById('flexJson').value.trim();
            if (!content) return showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', 'error');
            
            const formData = new FormData();
            formData.append('source', 'admin_panel');
            formData.append('action', 'addKeyword');
            formData.append('keyword', keywordText);
            formData.append('type', messageType);
            formData.append('content', content);
            formData.append('altText', altText);

            showNotification('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', 'info');
            fetch(GOOGLE_APPS_SCRIPT_URL, { method: 'POST', body: formData })
                .then(res => res.json())
                .then(result => {
                    if (result.status === 'success') {
                        showNotification('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                        closeKeywordModal();
                        fetchKeywords();
                    } else { throw new Error(result.message); }
                })
                .catch(error => showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error'));
        }

        async function deleteKeyword(keywordText) {
            if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î "${keywordText}"?`)) return;
            
            const formData = new FormData();
            formData.append('source', 'admin_panel');
            formData.append('action', 'deleteKeyword');
            formData.append('keyword', keywordText);

            try {
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, { method: 'POST', body: formData });
                const result = await response.json();
                if (result.status === 'success') {
                    showNotification('‡∏•‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    fetchKeywords();
                } else { throw new Error(result.message || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î'); }
            } catch (error) {
                showNotification(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            }
        }

        function populateKeywords() {
            const container = document.getElementById('keywordsList');
            if (!keywords || keywords.length === 0) {
                container.innerHTML = `<p class="text-white/60 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î</p>`;
                return;
            }
            container.innerHTML = keywords.map(k => `
                <div class="glass p-3 rounded-lg flex justify-between items-center">
                    <div class="truncate"><i class="fas fa-tag text-blue-300 mr-3"></i><span class="font-medium text-white">${k.keyword}</span><p class="text-xs text-white/60 truncate">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${k.type}</p></div>
                    <div><button onclick="deleteKeyword('${k.keyword}')" class="text-red-400 hover:text-red-200 px-2"><i class="fas fa-trash"></i></button></div>
                </div>
            `).join('');
        }
        
        function closeKeywordModal() {
            document.getElementById('addKeywordModal').classList.add('hidden');
            document.getElementById('addKeywordModal').querySelector('form').reset();
        }

        function toggleMessageInputs() {
            const type = document.getElementById('messageType').value;
            document.getElementById('textInput').style.display = type === 'text' ? 'block' : 'none';
            document.getElementById('imageInput').style.display = type === 'image' ? 'block' : 'none';
            document.getElementById('flexInput').style.display = type === 'flex' ? 'block' : 'none';
        }

        // =======================================================
        // ü§ñ BOT INFO & UI FUNCTIONS
        // =======================================================
        async function fetchBotInfo() {
            const proxyUrl = 'https://cors-anywhere.herokuapp.com/'; 
            const botInfoApiUrl = 'https://api.line.me/v2/bot/info';
            const headers = { 'Authorization': 'Bearer ' + CHANNEL_ACCESS_TOKEN, 'X-Requested-With': 'XMLHttpRequest' };
            try {
                const [infoRes] = await Promise.all([ fetch(proxyUrl + botInfoApiUrl, { headers }) ]);
                if (infoRes.ok) {
                    const data = await infoRes.json();
                    document.getElementById('oaName').textContent = data.displayName;
                    document.getElementById('channelId').textContent = data.userId;
                    // Follower count requires special permissions, so we'll fetch it separately and handle errors gracefully.
                    fetchFollowerCount();
                } else {
                    throw new Error("Failed to fetch bot info");
                }
            } catch (error) {
                console.error('Error fetching bot info:', error);
                showNotification('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≠‡∏ó‡πÑ‡∏î‡πâ (‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î CORS Proxy)', 'error');
                document.getElementById('oaName').textContent = 'Error';
            }
        }
        
        async function fetchFollowerCount() {
            const proxyUrl = 'https://cors-anywhere.herokuapp.com/'; 
            const today = new Date().toISOString().slice(0, 10).replace(/-/g, "");
            const followersApiUrl = `https://api.line.me/v2/bot/insight/followers?date=${today}`;
            const headers = { 'Authorization': 'Bearer ' + CHANNEL_ACCESS_TOKEN, 'X-Requested-With': 'XMLHttpRequest' };
            try {
                const followersRes = await fetch(proxyUrl + followersApiUrl, { headers });
                if (followersRes.ok) {
                    const data = await followersRes.json();
                    document.getElementById('followerCount').textContent = `${(data.followers || 0).toLocaleString('th-TH')} ‡∏Ñ‡∏ô`;
                } else {
                     document.getElementById('followerCount').textContent = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á';
                }
            } catch (e) {
                console.error("Follower count error:", e);
                document.getElementById('followerCount').textContent = 'Error';
            }
        }

        function showSection(sectionName, element) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(sectionName).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('bg-white/20'));
            if (element) element.classList.add('bg-white/20');
        }

        function showAdminManagement() {
            fetchAdmins();
            document.getElementById('adminModal').classList.remove('hidden');
            hideUserMenu();
        }
        function hideAdminModal() { document.getElementById('adminModal').classList.add('hidden'); }
        function toggleUserMenu() { document.getElementById('userMenu').classList.toggle('hidden'); }
        function hideUserMenu() { document.getElementById('userMenu').classList.add('hidden'); }
        function toggleMobileSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('mobileOverlay').classList.toggle('active'); }
        function closeMobileSidebar() { document.getElementById('sidebar').classList.remove('open'); document.getElementById('mobileOverlay').classList.remove('active'); }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notif = document.createElement('div');
            const colors = { success: 'bg-green-500', error: 'bg-red-500', info: 'bg-blue-500', warning: 'bg-yellow-500' };
            const icons = { success: 'fa-check-circle', error: 'fa-exclamation-circle', info: 'fa-info-circle', warning: 'fa-exclamation-triangle' };
            notif.className = `${colors[type]} text-white px-4 py-3 rounded-lg shadow-lg flex items-center space-x-2 slide-in`;
            notif.innerHTML = `<i class="fas ${icons[type]}"></i><span>${message}</span>`;
            container.appendChild(notif);
            setTimeout(() => { notif.remove(); }, 3000);
        }

        document.addEventListener('click', (event) => {
            if (!event.target.closest('#userMenu') && !event.target.closest('button[onclick="toggleUserMenu()"]')) {
                hideUserMenu();
            }
        });
    </script>
</body>
</html>
